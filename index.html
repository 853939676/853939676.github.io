<html>

<head>
    <title>Rui Liu IS545 Final Project</title>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>

<body>
    <h1>About the dataset</h1>
    <p>https://data.ccrpc.org/dataset/traffic-crashes
        traffic crashes in Champaign County from 1999 to 2017. It contains information including weather, street
        lighting, road surface, and traffic control condition of the location where crashes happened, and number of
        injuries/fatalities resulted.
    </p>
    <h2>Data preprocessing</h2>
    <p> Data preprocessing was done using both Python and OpenRefine to merge multiple datasets and clean low-quality
        records.</p>
    <h1>Premade Visualizations</h1>
    <p>Map of traffic crashes in Champaign County</p>
    <div id="map_vis"></div>
    <p>Injuries and count of records by year</p>
    <div id="fact_vis"></div>
    <p>Statistics</p>


</body>
<script>
    var map_vis_spec =
    {
        "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
        "width": 400,
        "height": 500,
        "layer": [
            {
                "data": {
                    "url": "https://raw.githubusercontent.com/kthotav/TopoJSON-Maps/master/usa/usa-states/illinois/illinois-counties.json",
                    "format": {
                        "type": "topojson",
                        "feature": "illinois-counties"
                    }
                },
                "transform": [
                    {
                        "filter": {
                            "field": "properties.NAME",
                            "equal": "Champaign"
                        }
                    }
                ],
                "projection": {
                    "type": "mercator"
                },
                "mark": {
                    "type": "geoshape",
                    "fill": "#e9ebf0",
                    "stroke": "white"
                }
            },
            {
                "data": {
                    "url": "https://raw.githubusercontent.com/853939676/IS545/main/final_crashes.csv"
                },
                "projection": {
                    "type": "albersUsa"
                },
                "mark": "circle",
                "encoding": {
                    "longitude": {
                        "field": "x",
                        "type": "quantitative"
                    },
                    "latitude": {
                        "field": "y",
                        "type": "quantitative"
                    },
                    "size": { "value": 10 },
                    "color": { "value": "steelblue" },
                    "tooltip": [
                        { "field": "year", "type": "quantitative" },
                        { "field": "city", "type": "ordinal" },
                        { "field": "collision_type", "type": "ordinal" },
                        { "field": "fatality", "type": "quantitative" },
                        { "field": "injury", "type": "quantitative" }

                    ]
                }
            }
        ]
    };
    var embedded = vegaEmbed('#map_vis', map_vis_spec);

    var fact_spec =
    {
        "$schema": "https://vega.github.io/schema/vega-lite/v4.json",
        "data": { "url": "https://raw.githubusercontent.com/853939676/IS545/main/final_crashes.csv" },
        "vconcat": [
            {
                "mark": "circle",
                "encoding": {
                    "y": { "field": "injury", "type": "quantitative", "aggregate": "mean" },
                    "x": { "field": "year", "type": "ordinal" },
                    "size": {
                        "field": "injury",
                        "type": "quantitative",
                        "aggregate": "max"
                    },
                    "color": {
                        "field": "injury",
                        "type": "quantitative",
                        "aggregate": "max",
                        "scale": { "range": ["#c6dbef", "#1f77b4"] }
                    }
                }
            },
            {
                "mark": { "type": "bar" },
                "encoding": {
                    "x": { "field": "year", "type": "ordinal" },
                    "y": { "aggregate": "count", "type": "quantitative" },
                    "color": {
                        "field": "city",
                        "type": "nominal"
                    }
                }
            }
        ]
    };
    var embedded = vegaEmbed('#fact_vis', fact_spec);
    ;

</script>

</html>